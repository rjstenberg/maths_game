<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Map Levels with SweetAlert2</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      background: #222;
      font-family: Arial, sans-serif;
    }

    /* Map container */
    .map-container {
      position: relative;
      width: 80vw;   /* Responsive width */
      max-width: 1000px;
    }

    .map-container img {
      width: 100%;
      height: auto;
      display: block;
    }

    /* Levels positioned relative to container */
    .level {
      position: absolute;
      width: 5%;           /* Scale with map */
      aspect-ratio: 1/1;   /* Keep square */
      border: 2px solid #000;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .locked { background-color: red; cursor: not-allowed; }
    .open   { background-color: blue; }
    .done   { background-color: green; }
  </style>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

  <div class="map-container">
    <img src="map.png" alt="Map">

    <!-- Example levels -->
    <div id="level1" class="level open" style="top: 6.6%; left: 23.9%;">1</div>
    <div id="level2" class="level locked" style="top: 6.6%; left: 51.7%;">2</div>
    <div id="level3" class="level locked" style="top: 6.6%; left: 66.1%;">3</div>
    <div id="level3" class="level locked" style="top: 26.7%; left: 66.2%;">4</div>
    <div id="level3" class="level locked" style="top: 86.1%; left: 24%;">5</div>
    <div id="level3" class="level locked" style="top: 86.1%; left: 51.8%;">6</div>
    <div id="level3" class="level locked" style="top: 71.4%; left: 76.8%;">7</div>

  </div>

  <script>
    const levels = document.querySelectorAll('.level');
    let currentLevel = null;

    // Example question bank
    const questionBank = [
      { q: "5 + 3 = ?", a: "8" },
      { q: "10 - 4 = ?", a: "6" },
      { q: "3 × 3 = ?", a: "9" },
      { q: "12 ÷ 4 = ?", a: "3" }
    ];

    // Attach click listeners
    levels.forEach((lvl, idx) => {
      lvl.addEventListener('click', () => {
        if (lvl.classList.contains('open')) {
          currentLevel = idx;
          startQuiz();
        }
      });
    });

    function startQuiz() {
      // Pick 4 random questions
      const selected = questionBank.sort(() => 0.5 - Math.random()).slice(0, 4);

      // Build quiz HTML
      let formHtml = "<form id='quizForm'>";
      selected.forEach((q, i) => {
        formHtml += `
          <label>${q.q}</label><br>
          <input type="text" name="q${i}" data-answer="${q.a}" class="swal2-input" required><br>
        `;
      });
      formHtml += "</form>";

      // Show quiz popup
      Swal.fire({
        title: "Math Quiz",
        html: formHtml,
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: "Rätta",
        cancelButtonText: 'Avbryt',
        preConfirm: () => {
          const inputs = Swal.getHtmlContainer().querySelectorAll("input");
          let correct = 0;
          inputs.forEach(inp => {
            if (inp.value.trim() === inp.dataset.answer) correct++;
          });
          return correct / inputs.length;
        }
      }).then(result => {
        if (result.isConfirmed) {
          const score = result.value;
          if (score >= 0.75) {
            Swal.fire("Snyggt jobbat!", "Du har låst upp en ny nivå.", "success");
            levels[currentLevel].classList.remove('open');
            levels[currentLevel].classList.add('done');
            if (levels[currentLevel + 1]) {
              levels[currentLevel + 1].classList.remove('locked');
              levels[currentLevel + 1].classList.add('open');
            }
          } else {
            Swal.fire("Testa igen!", "Inte riktigt där än.", "question");
          }
        }
      });
    }
  </script>

</body>
</html>
